<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.6.40">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="emily zou">
<meta name="dcterms.date" content="2025-06-03">

<title>no, but actually, should i keep texting them?</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.5.1/jquery.min.js" integrity="sha512-bLT0Qm9VnAYZDflyKcBaQ2gg0hSYNQrJ8RilYldYQ1FxQYoCLtUjuuRuZo+fjqhx/qtq/1itJ0C2ejDxltZVFg==" crossorigin="anonymous"></script><script src="matsuri_files/libs/clipboard/clipboard.min.js"></script>
<script src="matsuri_files/libs/quarto-html/quarto.js"></script>
<script src="matsuri_files/libs/quarto-html/popper.min.js"></script>
<script src="matsuri_files/libs/quarto-html/tippy.umd.min.js"></script>
<script src="matsuri_files/libs/quarto-html/anchor.min.js"></script>
<link href="matsuri_files/libs/quarto-html/tippy.css" rel="stylesheet">
<link href="matsuri_files/libs/quarto-html/quarto-syntax-highlighting-549806ee2085284f45b00abea8c6df48.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="matsuri_files/libs/bootstrap/bootstrap.min.js"></script>
<link href="matsuri_files/libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="matsuri_files/libs/bootstrap/bootstrap-973236bd072d72a04ee9cd82dcc9cb29.min.css" rel="stylesheet" append-hash="true" id="quarto-bootstrap" data-mode="light">
<script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" integrity="sha512-c3Nl8+7g4LMSTdrm621y7kf9v3SDPnhxLNhcjFJbKECVnmZHTdo+IRO05sNLTH/D3vA6u1X32ehoLC7WFVdheg==" crossorigin="anonymous"></script>

<script type="application/javascript">define('jquery', [],function() {return window.jQuery;})</script>


</head>

<body>

<div id="quarto-content" class="page-columns page-rows-contents page-layout-article">
<div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
  <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">Table of contents</h2>
   
  <ul>
  <li><a href="#the-very-needed-and-not-exonerating-context" id="toc-the-very-needed-and-not-exonerating-context" class="nav-link active" data-scroll-target="#the-very-needed-and-not-exonerating-context">… the (very needed, and not exonerating) context</a>
  <ul class="collapse">
  <li><a href="#data-origins" id="toc-data-origins" class="nav-link" data-scroll-target="#data-origins">…. data origins</a></li>
  <li><a href="#data-ethics" id="toc-data-ethics" class="nav-link" data-scroll-target="#data-ethics">…. data ethics</a></li>
  </ul></li>
  <li><a href="#the-good-morning-text" id="toc-the-good-morning-text" class="nav-link" data-scroll-target="#the-good-morning-text">1…. the “good morning” text</a>
  <ul class="collapse">
  <li><a href="#this-data-is" id="toc-this-data-is" class="nav-link" data-scroll-target="#this-data-is">…. this data is</a></li>
  <li><a href="#what-can-we-learn-from-this" id="toc-what-can-we-learn-from-this" class="nav-link" data-scroll-target="#what-can-we-learn-from-this">…. what can we learn from this?</a></li>
  <li><a href="#the-gist-of-bootstrapping-is" id="toc-the-gist-of-bootstrapping-is" class="nav-link" data-scroll-target="#the-gist-of-bootstrapping-is">…. the gist of bootstrapping is</a></li>
  <li><a href="#this-would-help-us-in-theory" id="toc-this-would-help-us-in-theory" class="nav-link" data-scroll-target="#this-would-help-us-in-theory">…. this would help us in theory</a>
  <ul class="collapse">
  <li><a href="#but-76-points-isnt-really-enough-for-us-to-infer-anything" id="toc-but-76-points-isnt-really-enough-for-us-to-infer-anything" class="nav-link" data-scroll-target="#but-76-points-isnt-really-enough-for-us-to-infer-anything">…. but 76 points isn’t really enough for us to infer anything</a></li>
  </ul></li>
  <li><a href="#interpretation-me" id="toc-interpretation-me" class="nav-link" data-scroll-target="#interpretation-me">… interpretation (me)</a></li>
  <li><a href="#interpretation-them" id="toc-interpretation-them" class="nav-link" data-scroll-target="#interpretation-them">… interpretation (them)</a></li>
  </ul></li>
  <li><a href="#life-is-like-a-box-of-coin-flips" id="toc-life-is-like-a-box-of-coin-flips" class="nav-link" data-scroll-target="#life-is-like-a-box-of-coin-flips">2…. life is like a box of coin flips</a>
  <ul class="collapse">
  <li><a href="#this-data-is-1" id="toc-this-data-is-1" class="nav-link" data-scroll-target="#this-data-is-1">…. this data is</a></li>
  <li><a href="#what-can-we-learn-from-this-1" id="toc-what-can-we-learn-from-this-1" class="nav-link" data-scroll-target="#what-can-we-learn-from-this-1">…. what can we learn from this?</a></li>
  <li><a href="#we-have-to-assume-that" id="toc-we-have-to-assume-that" class="nav-link" data-scroll-target="#we-have-to-assume-that">…. we have to assume that…</a>
  <ul class="collapse">
  <li><a href="#shout-out-to-pset3-problem-7" id="toc-shout-out-to-pset3-problem-7" class="nav-link" data-scroll-target="#shout-out-to-pset3-problem-7">….shout out to pset3 problem 7</a></li>
  </ul></li>
  <li><a href="#conversations-are-not-like-coin-flips" id="toc-conversations-are-not-like-coin-flips" class="nav-link" data-scroll-target="#conversations-are-not-like-coin-flips">…. conversations are not like coin flips</a></li>
  <li><a href="#the-mechanics" id="toc-the-mechanics" class="nav-link" data-scroll-target="#the-mechanics">…. the mechanics</a></li>
  </ul></li>
  <li><a href="#double-texting-red-flag" id="toc-double-texting-red-flag" class="nav-link" data-scroll-target="#double-texting-red-flag">3 …. double texting? red flag</a>
  <ul class="collapse">
  <li><a href="#this-data-is-2" id="toc-this-data-is-2" class="nav-link" data-scroll-target="#this-data-is-2">…. this data is</a></li>
  <li><a href="#how" id="toc-how" class="nav-link" data-scroll-target="#how">…. how?</a></li>
  </ul></li>
  <li><a href="#do-not-disturb" id="toc-do-not-disturb" class="nav-link" data-scroll-target="#do-not-disturb">4 …. do not disturb</a>
  <ul class="collapse">
  <li><a href="#this-data-is-3" id="toc-this-data-is-3" class="nav-link" data-scroll-target="#this-data-is-3">…. this data is</a></li>
  <li><a href="#full-on-bootstrapping" id="toc-full-on-bootstrapping" class="nav-link" data-scroll-target="#full-on-bootstrapping">…. full on bootstrapping</a></li>
  </ul></li>
  <li><a href="#results" id="toc-results" class="nav-link" data-scroll-target="#results">5…. results</a></li>
  <li><a href="#conclusion" id="toc-conclusion" class="nav-link" data-scroll-target="#conclusion">6 …. conclusion</a></li>
  </ul>
</nav>
</div>
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">no, but actually, should i keep texting them?</h1>
<p class="subtitle lead">stanford cs 109 spring quarter final project entry</p>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>emily zou </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">June 3, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<blockquote class="blockquote">
<p><img src="cover2.jpg" class="img-fluid" alt="Screenshot"> <em>literally me</em></p>
</blockquote>
<div id="cdda60fd" class="cell" data-execution_count="1">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb1"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> pandas <span class="im">as</span> pd</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> numpy <span class="im">as</span> np</span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> matplotlib.pyplot <span class="im">as</span> plt</span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a><span class="im">import</span> seaborn <span class="im">as</span> sns</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> matplotlib.ticker <span class="im">import</span> FuncFormatter</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> scipy.stats <span class="im">import</span> wasserstein_distance</span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> collections <span class="im">import</span> Counter</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> datetime <span class="im">import</span> date, timedelta</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a><span class="im">from</span> itertools <span class="im">import</span> groupby</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="the-very-needed-and-not-exonerating-context" class="level1">
<h1>… the (very needed, and not exonerating) context</h1>
<section id="data-origins" class="level2">
<h2 class="anchored" data-anchor-id="data-origins">…. data origins</h2>
<p>I started talking to someone that I really like(d) on March 18, 2025 over Discord; between then and June 3, we’ve exchanged 15,965 messages. <br> However, in between then, I made a fatal mistake: I asked, “What are we?” <br> Since then, I began to suspect that the underlying distribution governing our interactions have fundamentally changed. <br> Was i imagining things? I wanted to see if the disruption to the rhythm of our conversation was statistically present. <br> I did this originally to study for the midterm (I am the worst kind of student, and have only ever learned from doing things myself), but to also accept the end of a friendship that had become part of my daily routine. <br></p>
<blockquote class="blockquote">
<p><img src="midterm_cap.png" class="img-fluid" alt="Screenshot"> <em>Screenshot of the first version of this</em></p>
</blockquote>
<p>After May 2nd, I did not stop talking to or seeing this person as of June 3 8:49PM. <br></p>
<p>BUT I’ve actually learned some probability since then! <br> Back then, my whole approach was just trying to estimate a PMF or CDF for the message-reply times and compare those directly. <br> Now that I know how bootstrapping works, I re-approached the question — “Are we still friends? Are we still the same?” — with four slightly more principled methods: <br></p>
<ol type="1">
<li>I used a lightweight bootstrapping method to compare when each of us sent the first message of the day, focusing on the median.<br>
</li>
<li>I treated each conversational turn as a Bernoulli trial — basically like a coin flip — and ran a first-order Markov model to find the most significant change point.<br>
</li>
<li>I used Wasserstein distance to track changes in the length of our conversation chunks over time.<br>
</li>
<li>I used full bootstrapping to test whether the time it took me to reply to them (and vice versa) changed meaningfully over the conversation.</li>
</ol>
</section>
<section id="data-ethics" class="level2">
<h2 class="anchored" data-anchor-id="data-ethics">…. data ethics</h2>
<ol type="1">
<li>They know about this — don’t worry.<br>
</li>
<li>All of the data is censored to just “Me” and “Them” and is available on the repo.<br>
</li>
<li>I pulled the messages using DiscordChatExporter (check it out here: https://github.com/Tyrrrz/DiscordChatExporter) by Oleksii Holub, which is also allowed generally because it is my own private messages.<br>
</li>
<li>I am not the kind of person that regularly does something like this. I just really, really don’t want to take the final.</li>
</ol>
<div id="d3dca9d4" class="cell" data-execution_count="2">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb2"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a>custom_palette <span class="op">=</span> [<span class="st">"#7CBFAF"</span>, <span class="st">"#5B7E37"</span>]</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>sns.set_theme(style<span class="op">=</span><span class="st">"whitegrid"</span>, palette<span class="op">=</span>custom_palette)</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'axes.facecolor'</span>] <span class="op">=</span> <span class="st">'#FCFAFD'</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>plt.rcParams[<span class="st">'figure.facecolor'</span>] <span class="op">=</span> <span class="st">'#FCFAFD'</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="3da11726" class="cell" data-execution_count="3">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb3"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> minutes_to_hhmm(x, _):</span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a>    h <span class="op">=</span> <span class="bu">int</span>(x) <span class="op">//</span> <span class="dv">60</span></span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a>    m <span class="op">=</span> <span class="bu">int</span>(x) <span class="op">%</span> <span class="dv">60</span></span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> <span class="ss">f"</span><span class="sc">{</span>h<span class="sc">:02}</span><span class="ss">:</span><span class="sc">{</span>m<span class="sc">:02}</span><span class="ss">"</span></span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<hr>
</section>
</section>
<section id="the-good-morning-text" class="level1">
<h1>1…. the “good morning” text</h1>
<div id="8c360f9e" class="cell" data-execution_count="4">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb4"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"not_me_first_message.txt"</span>) <span class="im">as</span> f:</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>    not_me_times <span class="op">=</span> [line.strip() <span class="cf">for</span> line <span class="kw">in</span> f <span class="cf">if</span> line.strip()]</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a><span class="cf">with</span> <span class="bu">open</span>(<span class="st">"me_first_message.txt"</span>) <span class="im">as</span> f:</span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>    me_times <span class="op">=</span> [line.strip() <span class="cf">for</span> line <span class="kw">in</span> f <span class="cf">if</span> line.strip()]</span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (me_times[:<span class="dv">5</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>['2025-03-18T11:34:39.4960000-07:00', '2025-03-19T08:11:48.3140000-07:00', '2025-03-20T09:22:46.9990000-07:00', '2025-03-21T10:10:45.3300000-07:00', '2025-03-22T08:43:25.0500000-07:00']</code></pre>
</div>
</div>
<blockquote class="blockquote">
<p><em>snippet of first message data (list)</em></p>
</blockquote>
<section id="this-data-is" class="level2">
<h2 class="anchored" data-anchor-id="this-data-is">…. this data is</h2>
<p>The time of the first message sent by the authors on each day. Because we’ve talked everyday, there are 76 points.</p>
</section>
<section id="what-can-we-learn-from-this" class="level2">
<h2 class="anchored" data-anchor-id="what-can-we-learn-from-this">…. what can we learn from this?</h2>
<p>We want to know if we can find the day we /know/ something changed from the data – this is one dimension.</p>
</section>
<section id="the-gist-of-bootstrapping-is" class="level2">
<h2 class="anchored" data-anchor-id="the-gist-of-bootstrapping-is">…. the gist of bootstrapping is</h2>
<p>Instead of assuming our data follows some neat theoretical distribution — like a normal curve — it builds a distribution directly from the data we actually have by repeatedly resampling our dataset to simulate what the range of possible outcomes might look like if you ran the experiment over and over. <br> In other words, it doesn’t guess what our data /should/ look like — it lets the data speak for itself.</p>
</section>
<section id="this-would-help-us-in-theory" class="level2">
<h2 class="anchored" data-anchor-id="this-would-help-us-in-theory">…. this would help us in theory</h2>
<p>Because we want to know if the timing of our first messages actually shifted, or if any differences we see could just be randomness. <br> Bootstrapping helps us estimate how much variation we’d expect even if nothing really changed — so if the real change stands out from that baseline, we can say it’s probably meaningful.</p>
<section id="but-76-points-isnt-really-enough-for-us-to-infer-anything" class="level3">
<h3 class="anchored" data-anchor-id="but-76-points-isnt-really-enough-for-us-to-infer-anything">…. but 76 points isn’t really enough for us to infer anything</h3>
<p>So instead, we set days as ‘cutoffs’ to compare distributions against, and we calculate the difference in medians. <br> We use medians here because it doesn’t make sense to find the ‘average’ time that something happens by adding up time – if i take medicine either at morning or at night, it doesn’t mean that ‘noon’ is a meaningful reference point for us.</p>
<div id="b5380c9b" class="cell" data-execution_count="5">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb6"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> first_contact_comparison(me_times, not_me_times):</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a>    me_df <span class="op">=</span> pd.DataFrame({<span class="st">'datetime'</span>: pd.to_datetime(me_times)})</span>
<span id="cb6-3"><a href="#cb6-3" aria-hidden="true" tabindex="-1"></a>    me_df[<span class="st">'time_of_day_minutes'</span>] <span class="op">=</span> me_df[<span class="st">'datetime'</span>].dt.hour <span class="op">*</span> <span class="dv">60</span> <span class="op">+</span> me_df[<span class="st">'datetime'</span>].dt.minute</span>
<span id="cb6-4"><a href="#cb6-4" aria-hidden="true" tabindex="-1"></a>    me_df <span class="op">=</span> me_df.sort_values(<span class="st">'datetime'</span>)</span>
<span id="cb6-5"><a href="#cb6-5" aria-hidden="true" tabindex="-1"></a>    not_me_df <span class="op">=</span> pd.DataFrame({<span class="st">'datetime'</span>: pd.to_datetime(not_me_times)})</span>
<span id="cb6-6"><a href="#cb6-6" aria-hidden="true" tabindex="-1"></a>    not_me_df[<span class="st">'time_of_day_minutes'</span>] <span class="op">=</span> not_me_df[<span class="st">'datetime'</span>].dt.hour <span class="op">*</span> <span class="dv">60</span> <span class="op">+</span> not_me_df[<span class="st">'datetime'</span>].dt.minute</span>
<span id="cb6-7"><a href="#cb6-7" aria-hidden="true" tabindex="-1"></a>    not_me_df <span class="op">=</span> not_me_df.sort_values(<span class="st">'datetime'</span>)</span>
<span id="cb6-8"><a href="#cb6-8" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">8</span>, <span class="dv">5</span>))</span>
<span id="cb6-9"><a href="#cb6-9" aria-hidden="true" tabindex="-1"></a>    plt.plot(me_df[<span class="st">'datetime'</span>], me_df[<span class="st">'time_of_day_minutes'</span>], label<span class="op">=</span><span class="st">"Me"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb6-10"><a href="#cb6-10" aria-hidden="true" tabindex="-1"></a>    plt.plot(not_me_df[<span class="st">'datetime'</span>], not_me_df[<span class="st">'time_of_day_minutes'</span>], label<span class="op">=</span><span class="st">"Them"</span>, linewidth<span class="op">=</span><span class="fl">1.5</span>)</span>
<span id="cb6-11"><a href="#cb6-11" aria-hidden="true" tabindex="-1"></a>    plt.gca().yaxis.set_major_formatter(FuncFormatter(minutes_to_hhmm))</span>
<span id="cb6-12"><a href="#cb6-12" aria-hidden="true" tabindex="-1"></a>    plt.ylim(<span class="dv">1440</span>, <span class="dv">240</span>)</span>
<span id="cb6-13"><a href="#cb6-13" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"first message of the day"</span>)</span>
<span id="cb6-14"><a href="#cb6-14" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"date"</span>)</span>
<span id="cb6-15"><a href="#cb6-15" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"time of day"</span>)</span>
<span id="cb6-16"><a href="#cb6-16" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb6-17"><a href="#cb6-17" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb6-18"><a href="#cb6-18" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb6-19"><a href="#cb6-19" aria-hidden="true" tabindex="-1"></a>first_contact_comparison(me_times, not_me_times)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="matsuri_files/figure-html/cell-6-output-1.png" width="752" height="464" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="9d1ef017" class="cell" data-execution_count="6">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb7"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> find_shift_point(times):</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> pd.DataFrame({<span class="st">'datetime'</span>: pd.to_datetime(times)})</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'minutes'</span>] <span class="op">=</span> df[<span class="st">'datetime'</span>].dt.hour <span class="op">*</span> <span class="dv">60</span> <span class="op">+</span> df[<span class="st">'datetime'</span>].dt.minute</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values(<span class="st">'datetime'</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb7-5"><a href="#cb7-5" aria-hidden="true" tabindex="-1"></a>    scores <span class="op">=</span> []</span>
<span id="cb7-6"><a href="#cb7-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>, <span class="bu">len</span>(df)<span class="op">-</span><span class="dv">10</span>):  </span>
<span id="cb7-7"><a href="#cb7-7" aria-hidden="true" tabindex="-1"></a>        before <span class="op">=</span> df.loc[:i<span class="op">-</span><span class="dv">1</span>, <span class="st">'minutes'</span>]</span>
<span id="cb7-8"><a href="#cb7-8" aria-hidden="true" tabindex="-1"></a>        after <span class="op">=</span> df.loc[i:, <span class="st">'minutes'</span>]</span>
<span id="cb7-9"><a href="#cb7-9" aria-hidden="true" tabindex="-1"></a>        diff <span class="op">=</span> np.median(after) <span class="op">-</span> np.median(before)</span>
<span id="cb7-10"><a href="#cb7-10" aria-hidden="true" tabindex="-1"></a>        scores.append((df.loc[i, <span class="st">'datetime'</span>].date(), diff))</span>
<span id="cb7-11"><a href="#cb7-11" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(scores, columns<span class="op">=</span>[<span class="st">"date"</span>, <span class="st">"median_diff"</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="1c93797e" class="cell" data-execution_count="7">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb8"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a>me1 <span class="op">=</span> find_shift_point(me_times)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>them1 <span class="op">=</span> find_shift_point(not_me_times)</span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_shift_results(results_df):</span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>    results_df <span class="op">=</span> results_df.sort_values(<span class="st">"date"</span>)</span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    x <span class="op">=</span> pd.to_datetime(results_df[<span class="st">"date"</span>])</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>    y <span class="op">=</span> results_df[<span class="st">"median_diff"</span>]</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">5</span>))</span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    plt.plot(x, y, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>    plt.axhline(<span class="dv">0</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, color<span class="op">=</span><span class="st">'gray'</span>)</span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"median first message time at different date cutoffs"</span>)</span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"Date"</span>)</span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"median difference (in minutes)"</span>)</span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb8-17"><a href="#cb8-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_top_shifts(results_df, top_n<span class="op">=</span><span class="dv">3</span>):</span>
<span id="cb8-18"><a href="#cb8-18" aria-hidden="true" tabindex="-1"></a>    top <span class="op">=</span> results_df.reindex(results_df[<span class="st">'median_diff'</span>].<span class="bu">abs</span>().sort_values(ascending<span class="op">=</span><span class="va">False</span>).index).head(top_n)</span>
<span id="cb8-19"><a href="#cb8-19" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"top </span><span class="sc">{</span>top_n<span class="sc">}</span><span class="ss"> most significant change points (by absolute median shift):"</span>)</span>
<span id="cb8-20"><a href="#cb8-20" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(top)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
</section>
<section id="interpretation-me" class="level2">
<h2 class="anchored" data-anchor-id="interpretation-me">… interpretation (me)</h2>
<p>A lower median difference — like the one I found — means I started replying earlier in the day. In other words, the median time of my replies shifted earlier in the later part of the conversation compared to before.</p>
<div id="9cf27d9b" class="cell" data-execution_count="8">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb9"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>plot_shift_results(me1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="matsuri_files/figure-html/cell-9-output-1.png" width="944" height="464" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="eac23727" class="cell" data-execution_count="9">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb10"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a>print_top_shifts(me1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>top 3 most significant change points (by absolute median shift):
          date  median_diff
48  2025-05-17        -81.5
49  2025-05-18        -80.0
47  2025-05-16        -80.0</code></pre>
</div>
</div>
</section>
<section id="interpretation-them" class="level2">
<h2 class="anchored" data-anchor-id="interpretation-them">… interpretation (them)</h2>
<p>The day-by-day medians of their reply times show a clear upward trend, meaning that — statistically — they’ve started to respond later in the day.</p>
<div id="ef98b4fc" class="cell" data-execution_count="10">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb12"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a>plot_shift_results(them1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="matsuri_files/figure-html/cell-11-output-1.png" width="944" height="464" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="cc510103" class="cell" data-execution_count="11">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb13"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a>print_top_shifts(them1)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>top 3 most significant change points (by absolute median shift):
          date  median_diff
27  2025-04-24        138.0
21  2025-04-18        131.0
37  2025-05-04        130.0</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="life-is-like-a-box-of-coin-flips" class="level1">
<h1>2…. life is like a box of coin flips</h1>
<div id="57dd6a58" class="cell" data-execution_count="12">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb15"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a>coins <span class="op">=</span> pd.read_csv(<span class="st">"binomial_input.csv"</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>coins.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="44">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">author</th>
<th data-quarto-table-cell-role="th">date</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>Them</td>
<td>2025-03-18 11:34:14.738000-07:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>Me</td>
<td>2025-03-18 11:34:39.496000-07:00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>Me</td>
<td>2025-03-18 11:34:56.683000-07:00</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>Them</td>
<td>2025-03-18 11:35:36.150000-07:00</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>Them</td>
<td>2025-03-18 11:36:25.037000-07:00</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="this-data-is-1" class="level2">
<h2 class="anchored" data-anchor-id="this-data-is-1">…. this data is</h2>
<p>The turn-taking pattern of our conversation — who replied to whom, and when — looks a lot like a sequence of coin flips, just with timestamps attached.</p>
</section>
<section id="what-can-we-learn-from-this-1" class="level2">
<h2 class="anchored" data-anchor-id="what-can-we-learn-from-this-1">…. what can we learn from this?</h2>
<p>We’re looking for a shift in the rhythm of the exchange — a point where the pattern of back-and-forth noticeably changes. Can we pinpoint the moment the dynamic flipped?</p>
<div id="605ebaf4" class="cell" data-execution_count="13">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb16"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>coins[<span class="st">'date'</span>] <span class="op">=</span> pd.to_datetime(coins[<span class="st">"date"</span>], <span class="bu">format</span><span class="op">=</span><span class="st">"mixed"</span>).dt.tz_localize(<span class="va">None</span>)</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>runs <span class="op">=</span> [x <span class="cf">for</span> x <span class="kw">in</span> coins[<span class="st">'author'</span>]]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="9de62974" class="cell" data-execution_count="14">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb17"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="ss">f"total messages: </span><span class="sc">{</span><span class="bu">len</span>(coins)<span class="sc">}</span><span class="ss">"</span>) </span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>total messages: 15965</code></pre>
</div>
</div>
<div id="d60e971c" class="cell" data-execution_count="15">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb19"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a>counts <span class="op">=</span> Counter(runs)</span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(<span class="ss">f"i sent </span><span class="sc">{</span>counts[<span class="st">'Me'</span>]<span class="sc">}</span><span class="ss"> messages, they sent </span><span class="sc">{</span>counts[<span class="st">'Them'</span>]<span class="sc">}</span><span class="ss"> messages"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>i sent 8183 messages, they sent 7782 messages</code></pre>
</div>
</div>
</section>
<section id="we-have-to-assume-that" class="level2">
<h2 class="anchored" data-anchor-id="we-have-to-assume-that">…. we have to assume that…</h2>
<p>We assume that each turn in the conversation is generated as an independent and identically distributed (i.i.d.) random variable — for now, at least (we’ll get back to that).</p>
<p>To establish a baseline, we first estimate the overall probability of a message coming from either person ( the marginal probability that a given reply comes from me or from them).</p>
<div id="52cda4fd" class="cell" data-execution_count="16">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb21"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="ss">f"my empirical p -- </span><span class="sc">{</span>counts[<span class="st">'Me'</span>]<span class="op">/</span><span class="bu">len</span>(coins)<span class="sc">}</span><span class="ss">"</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span> (<span class="ss">f"their empirical p -- </span><span class="sc">{</span>counts[<span class="st">'Them'</span>]<span class="op">/</span><span class="bu">len</span>(coins)<span class="sc">}</span><span class="ss">"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>my empirical p -- 0.512558722204823
their empirical p -- 0.48744127779517693</code></pre>
</div>
</div>
<div id="08b00f30" class="cell" data-execution_count="17">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb23"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>the_runs <span class="op">=</span> [(key, <span class="bu">sum</span>(<span class="dv">1</span> <span class="cf">for</span> _ <span class="kw">in</span> group)) <span class="cf">for</span> key, group <span class="kw">in</span> groupby(runs)]</span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a>me_run_lengths <span class="op">=</span> [length <span class="cf">for</span> author, length <span class="kw">in</span> the_runs <span class="cf">if</span> author <span class="op">==</span> <span class="st">'Me'</span>]</span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a>them_run_lengths <span class="op">=</span> [length <span class="cf">for</span> author, length <span class="kw">in</span> the_runs <span class="cf">if</span> author <span class="op">==</span> <span class="st">'Them'</span>]</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="11df2a2c" class="cell" data-execution_count="18">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb24"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_run_length_comparison(me_run_lengths, them_run_lengths, p_me <span class="op">=</span> <span class="fl">0.5125</span>, p_them<span class="op">=</span> <span class="fl">0.4874</span>):</span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a>    fig, axes <span class="op">=</span> plt.subplots(<span class="dv">1</span>, <span class="dv">2</span>, figsize<span class="op">=</span>(<span class="dv">14</span>, <span class="dv">5</span>), sharey<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a>    bar_colors <span class="op">=</span> [<span class="st">'#7CBFAF'</span>, <span class="st">'#5B7E37'</span>]      </span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>    line_color <span class="op">=</span> <span class="st">'#A94E46'</span>                </span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ax, run_lengths, p, label, bar_color <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a>        axes,</span>
<span id="cb24-7"><a href="#cb24-7" aria-hidden="true" tabindex="-1"></a>        [me_run_lengths, them_run_lengths],</span>
<span id="cb24-8"><a href="#cb24-8" aria-hidden="true" tabindex="-1"></a>        [p_me, p_them],</span>
<span id="cb24-9"><a href="#cb24-9" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'my'</span>, <span class="st">'their'</span>],</span>
<span id="cb24-10"><a href="#cb24-10" aria-hidden="true" tabindex="-1"></a>        bar_colors):</span>
<span id="cb24-11"><a href="#cb24-11" aria-hidden="true" tabindex="-1"></a>        counts <span class="op">=</span> Counter(run_lengths)</span>
<span id="cb24-12"><a href="#cb24-12" aria-hidden="true" tabindex="-1"></a>        observed_lengths <span class="op">=</span> np.array(<span class="bu">sorted</span>(counts.keys()))</span>
<span id="cb24-13"><a href="#cb24-13" aria-hidden="true" tabindex="-1"></a>        observed_freqs <span class="op">=</span> np.array([counts[k] <span class="cf">for</span> k <span class="kw">in</span> observed_lengths])</span>
<span id="cb24-14"><a href="#cb24-14" aria-hidden="true" tabindex="-1"></a>        expected_probs <span class="op">=</span> [(<span class="dv">1</span> <span class="op">-</span> p) <span class="op">*</span> p<span class="op">**</span>(k <span class="op">-</span> <span class="dv">1</span>) <span class="cf">for</span> k <span class="kw">in</span> observed_lengths]</span>
<span id="cb24-15"><a href="#cb24-15" aria-hidden="true" tabindex="-1"></a>        expected_counts <span class="op">=</span> np.array(expected_probs) <span class="op">*</span> <span class="bu">sum</span>(observed_freqs)</span>
<span id="cb24-16"><a href="#cb24-16" aria-hidden="true" tabindex="-1"></a>        ax.bar(observed_lengths, observed_freqs, width<span class="op">=</span><span class="fl">0.4</span>, label<span class="op">=</span><span class="st">'Observed'</span>, align<span class="op">=</span><span class="st">'center'</span>, color<span class="op">=</span>bar_color, alpha<span class="op">=</span><span class="fl">0.8</span>)</span>
<span id="cb24-17"><a href="#cb24-17" aria-hidden="true" tabindex="-1"></a>        ax.plot(observed_lengths, expected_counts, <span class="st">'o-'</span>, label<span class="op">=</span><span class="st">'Expected (Geometric)'</span>, linewidth<span class="op">=</span><span class="dv">2</span>, color<span class="op">=</span>line_color)</span>
<span id="cb24-18"><a href="#cb24-18" aria-hidden="true" tabindex="-1"></a>        ax.set_title(<span class="ss">f'</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss"> run lengths'</span>)</span>
<span id="cb24-19"><a href="#cb24-19" aria-hidden="true" tabindex="-1"></a>        ax.set_xlabel(<span class="st">'run length'</span>)</span>
<span id="cb24-20"><a href="#cb24-20" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">'frequency'</span>)</span>
<span id="cb24-21"><a href="#cb24-21" aria-hidden="true" tabindex="-1"></a>        ax.legend()</span>
<span id="cb24-22"><a href="#cb24-22" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb24-23"><a href="#cb24-23" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<section id="shout-out-to-pset3-problem-7" class="level3">
<h3 class="anchored" data-anchor-id="shout-out-to-pset3-problem-7">….shout out to pset3 problem 7</h3>
<p>But what we want to know is a little different – we’re also looking at the results of coin flips, but we want to figure out if someone started making up the results halfway. The run lengths — how many times in a row one person spoke — closely match what we’d expect from a geometric distribution. That means the conversation, overall, looks like a memoryless process: the chance of switching speakers stays about the same no matter how long someone has been talking. Nothing weird is happening just from the structure alone — so if we do see a change later on, it’s probably real, not just a fluke of how the data is shaped.</p>
</section>
</section>
<section id="conversations-are-not-like-coin-flips" class="level2">
<h2 class="anchored" data-anchor-id="conversations-are-not-like-coin-flips">…. conversations are not like coin flips</h2>
<p>In a pure coin flip, each outcome is independent — the result of one flip tells you nothing about the next. But conversations aren’t like that… whether I speak again or you do (to some extent) depends on who spoke last. So, we assume that these transitions follow a first-order Markov process — meaning that the next speaker depends only on who spoke last, not on anything before that.</p>
<div id="c473374f" class="cell" data-execution_count="19">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb25"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>plot_run_length_comparison(me_run_lengths, them_run_lengths)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="matsuri_files/figure-html/cell-20-output-1.png" width="1328" height="463" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="09c8db86" class="cell" data-execution_count="20">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb26"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a>pairs <span class="op">=</span> [</span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a>    (the_runs[i][<span class="dv">0</span>], the_runs[i][<span class="dv">1</span>], the_runs[i<span class="op">+</span><span class="dv">1</span>][<span class="dv">0</span>], the_runs[i<span class="op">+</span><span class="dv">1</span>][<span class="dv">1</span>])</span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(the_runs)<span class="op">-</span><span class="dv">1</span>)</span>
<span id="cb26-4"><a href="#cb26-4" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> the_runs[i][<span class="dv">0</span>] <span class="op">!=</span> the_runs[i<span class="op">+</span><span class="dv">1</span>][<span class="dv">0</span>]</span>
<span id="cb26-5"><a href="#cb26-5" aria-hidden="true" tabindex="-1"></a>]</span>
<span id="cb26-6"><a href="#cb26-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-7"><a href="#cb26-7" aria-hidden="true" tabindex="-1"></a>local_ratios <span class="op">=</span> []</span>
<span id="cb26-8"><a href="#cb26-8" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> a1, l1, a2, l2 <span class="kw">in</span> pairs:</span>
<span id="cb26-9"><a href="#cb26-9" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> {a1, a2} <span class="op">==</span> {<span class="st">'Me'</span>, <span class="st">'Them'</span>}:</span>
<span id="cb26-10"><a href="#cb26-10" aria-hidden="true" tabindex="-1"></a>        me_len <span class="op">=</span> l1 <span class="cf">if</span> a1 <span class="op">==</span> <span class="st">'Me'</span> <span class="cf">else</span> l2</span>
<span id="cb26-11"><a href="#cb26-11" aria-hidden="true" tabindex="-1"></a>        them_len <span class="op">=</span> l1 <span class="cf">if</span> a1 <span class="op">==</span> <span class="st">'Them'</span> <span class="cf">else</span> l2</span>
<span id="cb26-12"><a href="#cb26-12" aria-hidden="true" tabindex="-1"></a>        local_ratios.append(me_len <span class="op">/</span> (me_len <span class="op">+</span> them_len))  <span class="co"># my share of this exchange</span></span>
<span id="cb26-13"><a href="#cb26-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-14"><a href="#cb26-14" aria-hidden="true" tabindex="-1"></a>run_indices <span class="op">=</span> []</span>
<span id="cb26-15"><a href="#cb26-15" aria-hidden="true" tabindex="-1"></a>i <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb26-16"><a href="#cb26-16" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> speaker, length <span class="kw">in</span> the_runs:</span>
<span id="cb26-17"><a href="#cb26-17" aria-hidden="true" tabindex="-1"></a>    run_indices.append((speaker, length, i))  <span class="co"># i = start index of run in coins</span></span>
<span id="cb26-18"><a href="#cb26-18" aria-hidden="true" tabindex="-1"></a>    i <span class="op">+=</span> length</span>
<span id="cb26-19"><a href="#cb26-19" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-20"><a href="#cb26-20" aria-hidden="true" tabindex="-1"></a>    </span>
<span id="cb26-21"><a href="#cb26-21" aria-hidden="true" tabindex="-1"></a>local_dates <span class="op">=</span> []</span>
<span id="cb26-22"><a href="#cb26-22" aria-hidden="true" tabindex="-1"></a><span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>(<span class="bu">len</span>(run_indices) <span class="op">-</span> <span class="dv">1</span>):</span>
<span id="cb26-23"><a href="#cb26-23" aria-hidden="true" tabindex="-1"></a>    a1, _, idx1 <span class="op">=</span> run_indices[i]</span>
<span id="cb26-24"><a href="#cb26-24" aria-hidden="true" tabindex="-1"></a>    a2, _, idx2 <span class="op">=</span> run_indices[i <span class="op">+</span> <span class="dv">1</span>]</span>
<span id="cb26-25"><a href="#cb26-25" aria-hidden="true" tabindex="-1"></a>    <span class="cf">if</span> {a1, a2} <span class="op">==</span> {<span class="st">'Me'</span>, <span class="st">'Them'</span>}:</span>
<span id="cb26-26"><a href="#cb26-26" aria-hidden="true" tabindex="-1"></a>        start_idx <span class="op">=</span> <span class="bu">min</span>(idx1, idx2)</span>
<span id="cb26-27"><a href="#cb26-27" aria-hidden="true" tabindex="-1"></a>        local_dates.append(coins.iloc[start_idx][<span class="st">'date'</span>])</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
</section>
<section id="the-mechanics" class="level2">
<h2 class="anchored" data-anchor-id="the-mechanics">…. the mechanics</h2>
<ol type="1">
<li><p>We make a transition matrix (like in 3.7!) – the probabilities of switching from one speaker to the other – since we’re concerned with the ‘first-order’, there’s only four possibilites we’re interested in [(Me, Me), (Me, Them), (Them, Me), (Them, Them)].</p></li>
<li><p>To find out when that structure changes, we try splitting the conversation at every possible point and fit a separate Markov model to the “before” and “after” segments.</p></li>
<li><p>For each split, we calculate a log-likelihood — a measure of how well each model explains its half of the data.</p></li>
<li><p>We compare those likelihoods to a single model that tries to explain everything, and look for where the biggest jump in explanatory power happens.</p></li>
</ol>
<p>That’s probably when something changed.</p>
<div id="3af5ef99" class="cell" data-execution_count="21">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb27"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> get_transition_matrix(author_sequence):</span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a>    transitions <span class="op">=</span> <span class="bu">list</span>(<span class="bu">zip</span>(author_sequence[:<span class="op">-</span><span class="dv">1</span>], author_sequence[<span class="dv">1</span>:]))</span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a>    counts <span class="op">=</span> Counter(transitions)</span>
<span id="cb27-4"><a href="#cb27-4" aria-hidden="true" tabindex="-1"></a>    total_from <span class="op">=</span> Counter(a <span class="cf">for</span> a, _ <span class="kw">in</span> transitions)</span>
<span id="cb27-5"><a href="#cb27-5" aria-hidden="true" tabindex="-1"></a>    matrix <span class="op">=</span> {}</span>
<span id="cb27-6"><a href="#cb27-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> (a1, a2), count <span class="kw">in</span> counts.items():</span>
<span id="cb27-7"><a href="#cb27-7" aria-hidden="true" tabindex="-1"></a>        matrix[(a1, a2)] <span class="op">=</span> count <span class="op">/</span> total_from[a1]</span>
<span id="cb27-8"><a href="#cb27-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> matrix</span>
<span id="cb27-9"><a href="#cb27-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-10"><a href="#cb27-10" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> log_likelihood(segment, trans_probs):</span>
<span id="cb27-11"><a href="#cb27-11" aria-hidden="true" tabindex="-1"></a>    ll <span class="op">=</span> <span class="dv">0</span></span>
<span id="cb27-12"><a href="#cb27-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> a1, a2 <span class="kw">in</span> <span class="bu">zip</span>(segment[:<span class="op">-</span><span class="dv">1</span>], segment[<span class="dv">1</span>:]):</span>
<span id="cb27-13"><a href="#cb27-13" aria-hidden="true" tabindex="-1"></a>        prob <span class="op">=</span> trans_probs.get((a1, a2), <span class="fl">1e-8</span>)</span>
<span id="cb27-14"><a href="#cb27-14" aria-hidden="true" tabindex="-1"></a>        ll <span class="op">+=</span> np.log(prob)</span>
<span id="cb27-15"><a href="#cb27-15" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> ll</span>
<span id="cb27-16"><a href="#cb27-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-17"><a href="#cb27-17" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> scan_for_change_point(sequence):</span>
<span id="cb27-18"><a href="#cb27-18" aria-hidden="true" tabindex="-1"></a>    n <span class="op">=</span> <span class="bu">len</span>(sequence)</span>
<span id="cb27-19"><a href="#cb27-19" aria-hidden="true" tabindex="-1"></a>    global_model <span class="op">=</span> get_transition_matrix(sequence)</span>
<span id="cb27-20"><a href="#cb27-20" aria-hidden="true" tabindex="-1"></a>    global_ll <span class="op">=</span> log_likelihood(sequence, global_model)</span>
<span id="cb27-21"><a href="#cb27-21" aria-hidden="true" tabindex="-1"></a>    best_k <span class="op">=</span> <span class="va">None</span></span>
<span id="cb27-22"><a href="#cb27-22" aria-hidden="true" tabindex="-1"></a>    best_diff <span class="op">=</span> <span class="op">-</span>np.inf</span>
<span id="cb27-23"><a href="#cb27-23" aria-hidden="true" tabindex="-1"></a>    diffs <span class="op">=</span> []</span>
<span id="cb27-24"><a href="#cb27-24" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> k <span class="kw">in</span> <span class="bu">range</span>(<span class="dv">10</span>, n <span class="op">-</span> <span class="dv">10</span>):</span>
<span id="cb27-25"><a href="#cb27-25" aria-hidden="true" tabindex="-1"></a>        seq1 <span class="op">=</span> sequence[:k]</span>
<span id="cb27-26"><a href="#cb27-26" aria-hidden="true" tabindex="-1"></a>        seq2 <span class="op">=</span> sequence[k:]</span>
<span id="cb27-27"><a href="#cb27-27" aria-hidden="true" tabindex="-1"></a>        model1 <span class="op">=</span> get_transition_matrix(seq1)</span>
<span id="cb27-28"><a href="#cb27-28" aria-hidden="true" tabindex="-1"></a>        model2 <span class="op">=</span> get_transition_matrix(seq2)</span>
<span id="cb27-29"><a href="#cb27-29" aria-hidden="true" tabindex="-1"></a>        ll1 <span class="op">=</span> log_likelihood(seq1, model1)</span>
<span id="cb27-30"><a href="#cb27-30" aria-hidden="true" tabindex="-1"></a>        ll2 <span class="op">=</span> log_likelihood(seq2, model2)</span>
<span id="cb27-31"><a href="#cb27-31" aria-hidden="true" tabindex="-1"></a>        piecewise_ll <span class="op">=</span> ll1 <span class="op">+</span> ll2</span>
<span id="cb27-32"><a href="#cb27-32" aria-hidden="true" tabindex="-1"></a>        diff <span class="op">=</span> piecewise_ll <span class="op">-</span> global_ll</span>
<span id="cb27-33"><a href="#cb27-33" aria-hidden="true" tabindex="-1"></a>        diffs.append(diff)</span>
<span id="cb27-34"><a href="#cb27-34" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> diff <span class="op">&gt;</span> best_diff:</span>
<span id="cb27-35"><a href="#cb27-35" aria-hidden="true" tabindex="-1"></a>            best_diff <span class="op">=</span> diff</span>
<span id="cb27-36"><a href="#cb27-36" aria-hidden="true" tabindex="-1"></a>            best_k <span class="op">=</span> k</span>
<span id="cb27-37"><a href="#cb27-37" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> best_k, best_diff, diffs</span>
<span id="cb27-38"><a href="#cb27-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-39"><a href="#cb27-39" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_point_change(the_runs, coins, step<span class="op">=</span><span class="dv">2000</span>):</span>
<span id="cb27-40"><a href="#cb27-40" aria-hidden="true" tabindex="-1"></a>    author_sequence <span class="op">=</span> [a <span class="cf">for</span> a, l <span class="kw">in</span> the_runs <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(l)]</span>
<span id="cb27-41"><a href="#cb27-41" aria-hidden="true" tabindex="-1"></a>    best_idx, _, diffs <span class="op">=</span> scan_for_change_point(author_sequence)</span>
<span id="cb27-42"><a href="#cb27-42" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-43"><a href="#cb27-43" aria-hidden="true" tabindex="-1"></a>    max_idx <span class="op">=</span> <span class="bu">min</span>(<span class="bu">len</span>(diffs), <span class="bu">len</span>(coins))</span>
<span id="cb27-44"><a href="#cb27-44" aria-hidden="true" tabindex="-1"></a>    label_indices <span class="op">=</span> <span class="bu">list</span>(<span class="bu">range</span>(<span class="dv">0</span>, max_idx, step))</span>
<span id="cb27-45"><a href="#cb27-45" aria-hidden="true" tabindex="-1"></a>    date_labels <span class="op">=</span> [</span>
<span id="cb27-46"><a href="#cb27-46" aria-hidden="true" tabindex="-1"></a>        pd.to_datetime(coins.iloc[i][<span class="st">'date'</span>]).strftime(<span class="st">'%m-</span><span class="sc">%d</span><span class="st">'</span>)</span>
<span id="cb27-47"><a href="#cb27-47" aria-hidden="true" tabindex="-1"></a>        <span class="cf">for</span> i <span class="kw">in</span> label_indices</span>
<span id="cb27-48"><a href="#cb27-48" aria-hidden="true" tabindex="-1"></a>    ]</span>
<span id="cb27-49"><a href="#cb27-49" aria-hidden="true" tabindex="-1"></a>    plt.figure(figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">4</span>))</span>
<span id="cb27-50"><a href="#cb27-50" aria-hidden="true" tabindex="-1"></a>    plt.plot(diffs)</span>
<span id="cb27-51"><a href="#cb27-51" aria-hidden="true" tabindex="-1"></a>    plt.axvline(best_idx, color<span class="op">=</span><span class="st">'red'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, label<span class="op">=</span><span class="st">'best change point'</span>)</span>
<span id="cb27-52"><a href="#cb27-52" aria-hidden="true" tabindex="-1"></a>    plt.xticks(label_indices, date_labels, ha<span class="op">=</span><span class="st">'right'</span>)</span>
<span id="cb27-53"><a href="#cb27-53" aria-hidden="true" tabindex="-1"></a>    plt.xlabel(<span class="st">"day"</span>)</span>
<span id="cb27-54"><a href="#cb27-54" aria-hidden="true" tabindex="-1"></a>    plt.ylabel(<span class="st">"log-likelihood improvement"</span>)</span>
<span id="cb27-55"><a href="#cb27-55" aria-hidden="true" tabindex="-1"></a>    plt.title(<span class="st">"first order markov change point detecting"</span>)</span>
<span id="cb27-56"><a href="#cb27-56" aria-hidden="true" tabindex="-1"></a>    plt.legend()</span>
<span id="cb27-57"><a href="#cb27-57" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb27-58"><a href="#cb27-58" aria-hidden="true" tabindex="-1"></a>    plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="580f3a67" class="cell" data-execution_count="22">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb28"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a>plot_point_change(the_runs, coins)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="matsuri_files/figure-html/cell-23-output-1.png" width="944" height="368" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<hr>
</section>
</section>
<section id="double-texting-red-flag" class="level1">
<h1>3 …. double texting? red flag</h1>
<div id="b8bad3b1" class="cell" data-execution_count="23">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb29"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a>me <span class="op">=</span> pd.read_csv(<span class="st">"me_convo.csv"</span>)</span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a>me.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="55">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">start_time</th>
<th data-quarto-table-cell-role="th">length</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2025-03-18 11:34:39.496000-07:00</td>
<td>2</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2025-03-18 15:42:13.935000-07:00</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2025-03-18 15:46:18.390000-07:00</td>
<td>1</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2025-03-18 15:46:20.746000-07:00</td>
<td>5</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2025-03-18 15:47:04.386000-07:00</td>
<td>1</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="this-data-is-2" class="level2">
<h2 class="anchored" data-anchor-id="this-data-is-2">…. this data is</h2>
<p>An extension of the above – but it’s focused on the length of each message run – how much one says to another before they reply.</p>
<div id="246505bb" class="cell" data-execution_count="24">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb30"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a>not_me <span class="op">=</span> pd.read_csv(<span class="st">"not_me_convo.csv"</span>)</span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a>me[<span class="st">"start_time"</span>] <span class="op">=</span> pd.to_datetime(me[<span class="st">"start_time"</span>], <span class="bu">format</span><span class="op">=</span><span class="st">"mixed"</span>).dt.tz_localize(<span class="va">None</span>)</span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a>not_me[<span class="st">"start_time"</span>] <span class="op">=</span> pd.to_datetime(not_me[<span class="st">"start_time"</span>], <span class="bu">format</span><span class="op">=</span><span class="st">"mixed"</span>).dt.tz_localize(<span class="va">None</span>)</span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a>fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">10</span>, <span class="dv">6</span>), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].plot(me[<span class="st">"start_time"</span>], me[<span class="st">"length"</span>], color<span class="op">=</span><span class="st">'#7CBFAF'</span>)</span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_ylabel(<span class="st">"chunk length"</span>)</span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">0</span>].set_title(<span class="st">"my message chunk lengths"</span>)</span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].plot(not_me[<span class="st">"start_time"</span>], not_me[<span class="st">"length"</span>], color<span class="op">=</span><span class="st">'#5B7E37'</span>)</span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_ylabel(<span class="st">"chunk length"</span>)</span>
<span id="cb30-10"><a href="#cb30-10" aria-hidden="true" tabindex="-1"></a>axs[<span class="dv">1</span>].set_title(<span class="st">"their message chunk lengths"</span>)</span>
<span id="cb30-11"><a href="#cb30-11" aria-hidden="true" tabindex="-1"></a>plt.xlabel(<span class="st">"day"</span>)</span>
<span id="cb30-12"><a href="#cb30-12" aria-hidden="true" tabindex="-1"></a>plt.tight_layout()</span>
<span id="cb30-13"><a href="#cb30-13" aria-hidden="true" tabindex="-1"></a>plt.show()</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="matsuri_files/figure-html/cell-25-output-1.png" width="944" height="560" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="how" class="level2">
<h2 class="anchored" data-anchor-id="how">…. how?</h2>
<p>We learned about total variational distance, Wasserstein’s distance, and KL divergence in class, which are methods that quantify how different two probability distributions are from each other. But Wasserstein’s (or the name with much more aura, Earth Mover’s) Distance doesn’t require us to know the underlying probability distributions— which is perfect, because we don’t. We’re just working with empirical distributions: the actual message chunk lengths from each day.</p>
<p>Wasserstein distance measures how much “work” it would take to turn one distribution into another — like how much you’d have to move dirt around to reshape one pile into another. That makes it great for comparing two distributions even when they don’t overlap much or when one is just a shifted or stretched version of the other.</p>
<p>In this case, we’re using it to compare the distributions of conversation chunk lengths over time, and whether the difference between days is small and consistent, or large and abrupt.</p>
<div id="29d2d3bb" class="cell" data-execution_count="25">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb31"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> compute_daily_wasserstein(df):</span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">"day"</span>] <span class="op">=</span> df[<span class="st">"start_time"</span>].dt.date</span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a>    df <span class="op">=</span> df.sort_values(<span class="st">"start_time"</span>).reset_index(drop<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a>    global_dist <span class="op">=</span> df[<span class="st">"length"</span>].dropna().values</span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> day, group <span class="kw">in</span> df.groupby(<span class="st">"day"</span>):</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>        day_vals <span class="op">=</span> group[<span class="st">"length"</span>].dropna().values</span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(day_vals) <span class="op">&lt;</span> <span class="dv">10</span>:</span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>        wdist <span class="op">=</span> wasserstein_distance(day_vals, global_dist)</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a>        results.append({<span class="st">"day"</span>: day, <span class="st">"wdist"</span>: wdist})</span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>    result_df <span class="op">=</span> pd.DataFrame(results)</span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>    result_df[<span class="st">"day"</span>] <span class="op">=</span> pd.to_datetime(result_df[<span class="st">"day"</span>])</span>
<span id="cb31-14"><a href="#cb31-14" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> result_df</span>
<span id="cb31-15"><a href="#cb31-15" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-16"><a href="#cb31-16" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_stacked_wasserstein(me_df, not_me_df):</span>
<span id="cb31-17"><a href="#cb31-17" aria-hidden="true" tabindex="-1"></a>    me_res <span class="op">=</span> compute_daily_wasserstein(me_df)</span>
<span id="cb31-18"><a href="#cb31-18" aria-hidden="true" tabindex="-1"></a>    not_me_res <span class="op">=</span> compute_daily_wasserstein(not_me_df)</span>
<span id="cb31-19"><a href="#cb31-19" aria-hidden="true" tabindex="-1"></a>    fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb31-20"><a href="#cb31-20" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>].plot(me_res[<span class="st">"day"</span>], me_res[<span class="st">"wdist"</span>], color<span class="op">=</span><span class="st">'#7CBFAF'</span>, label<span class="op">=</span><span class="st">"mine"</span>)</span>
<span id="cb31-21"><a href="#cb31-21" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>].set_title(<span class="st">"earth mover's distance (mine)"</span>)</span>
<span id="cb31-22"><a href="#cb31-22" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>].set_ylabel(<span class="st">"wasserstein distance"</span>)</span>
<span id="cb31-23"><a href="#cb31-23" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">1</span>].plot(not_me_res[<span class="st">"day"</span>], not_me_res[<span class="st">"wdist"</span>], color<span class="op">=</span><span class="st">'#5B7E37'</span>, label<span class="op">=</span><span class="st">"theirs"</span>)</span>
<span id="cb31-24"><a href="#cb31-24" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">1</span>].set_title(<span class="st">"earth mover's distance (theirs)"</span>)</span>
<span id="cb31-25"><a href="#cb31-25" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">1</span>].set_ylabel(<span class="st">"wasserstein distance"</span>)</span>
<span id="cb31-26"><a href="#cb31-26" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">1</span>].set_xlabel(<span class="st">"day"</span>)</span>
<span id="cb31-27"><a href="#cb31-27" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ax <span class="kw">in</span> axs:</span>
<span id="cb31-28"><a href="#cb31-28" aria-hidden="true" tabindex="-1"></a>        ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>)</span>
<span id="cb31-29"><a href="#cb31-29" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb31-30"><a href="#cb31-30" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb31-31"><a href="#cb31-31" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-32"><a href="#cb31-32" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> print_top_wasserstein_days(wdist_df, label):</span>
<span id="cb31-33"><a href="#cb31-33" aria-hidden="true" tabindex="-1"></a>    top3 <span class="op">=</span> wdist_df.sort_values(<span class="st">"wdist"</span>, ascending<span class="op">=</span><span class="va">False</span>).head(<span class="dv">3</span>)</span>
<span id="cb31-34"><a href="#cb31-34" aria-hidden="true" tabindex="-1"></a>    <span class="bu">print</span>(<span class="ss">f"Top 3 days with highest Wasserstein distance (</span><span class="sc">{</span>label<span class="sc">}</span><span class="ss">):"</span>)</span>
<span id="cb31-35"><a href="#cb31-35" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> _, row <span class="kw">in</span> top3.iterrows():</span>
<span id="cb31-36"><a href="#cb31-36" aria-hidden="true" tabindex="-1"></a>        <span class="bu">print</span>(<span class="ss">f"</span><span class="sc">{</span>row[<span class="st">'day'</span>]<span class="sc">.</span>date()<span class="sc">}</span><span class="ss"> — </span><span class="sc">{</span>row[<span class="st">'wdist'</span>]<span class="sc">:.4f}</span><span class="ss">"</span>)</span>
<span id="cb31-37"><a href="#cb31-37" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-38"><a href="#cb31-38" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-39"><a href="#cb31-39" aria-hidden="true" tabindex="-1"></a>me_res <span class="op">=</span> compute_daily_wasserstein(me)</span>
<span id="cb31-40"><a href="#cb31-40" aria-hidden="true" tabindex="-1"></a>not_me_res <span class="op">=</span> compute_daily_wasserstein(not_me)</span>
<span id="cb31-41"><a href="#cb31-41" aria-hidden="true" tabindex="-1"></a>plot_stacked_wasserstein(me, not_me)</span>
<span id="cb31-42"><a href="#cb31-42" aria-hidden="true" tabindex="-1"></a>print_top_wasserstein_days(me_res, <span class="st">"mine"</span>)</span>
<span id="cb31-43"><a href="#cb31-43" aria-hidden="true" tabindex="-1"></a>print_top_wasserstein_days(not_me_res, <span class="st">"theirs"</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="matsuri_files/figure-html/cell-26-output-1.png" width="1136" height="752" class="figure-img"></p>
</figure>
</div>
</div>
<div class="cell-output cell-output-stdout">
<pre><code>Top 3 days with highest Wasserstein distance (mine):
2025-04-24 — 1.2825
2025-05-04 — 0.9331
2025-04-04 — 0.7825
Top 3 days with highest Wasserstein distance (theirs):
2025-04-15 — 1.4468
2025-05-24 — 0.8420
2025-05-06 — 0.7404</code></pre>
</div>
</div>
<hr>
</section>
</section>
<section id="do-not-disturb" class="level1">
<h1>4 …. do not disturb</h1>
<div id="c735952b" class="cell" data-execution_count="26">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb33"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a>mez <span class="op">=</span> pd.read_csv(<span class="st">"me_reply_turns.csv"</span>)</span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a>mez.head(<span class="dv">5</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display" data-execution_count="58">
<div>


<table class="dataframe caption-top table table-sm table-striped small" data-quarto-postprocess="true" data-border="1">
<thead>
<tr class="header">
<th data-quarto-table-cell-role="th"></th>
<th data-quarto-table-cell-role="th">time</th>
<th data-quarto-table-cell-role="th">interval</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td data-quarto-table-cell-role="th">0</td>
<td>2025-03-18 11:34:39.496000-07:00</td>
<td>0.412633</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">1</td>
<td>2025-03-18 15:42:13.935000-07:00</td>
<td>246.629750</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">2</td>
<td>2025-03-18 15:46:18.390000-07:00</td>
<td>2.169300</td>
</tr>
<tr class="even">
<td data-quarto-table-cell-role="th">3</td>
<td>2025-03-18 15:46:20.746000-07:00</td>
<td>0.002067</td>
</tr>
<tr class="odd">
<td data-quarto-table-cell-role="th">4</td>
<td>2025-03-18 15:47:04.386000-07:00</td>
<td>0.193883</td>
</tr>
</tbody>
</table>

</div>
</div>
</div>
<section id="this-data-is-3" class="level2">
<h2 class="anchored" data-anchor-id="this-data-is-3">…. this data is</h2>
<p>The interval (in minutes) between each conversational turn / reply (switching from one person to another).</p>
<div id="ae582288" class="cell" data-execution_count="27">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb34"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a>mez <span class="op">=</span> pd.read_csv(<span class="st">"me_reply_turns.csv"</span>)</span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a>not_mez <span class="op">=</span> pd.read_csv(<span class="st">"not_me_reply_turns.csv"</span>)</span>
<span id="cb34-3"><a href="#cb34-3" aria-hidden="true" tabindex="-1"></a>mez[<span class="st">"start_time"</span>] <span class="op">=</span> pd.to_datetime(mez[<span class="st">"time"</span>], <span class="bu">format</span><span class="op">=</span><span class="st">"mixed"</span>).dt.tz_localize(<span class="va">None</span>)</span>
<span id="cb34-4"><a href="#cb34-4" aria-hidden="true" tabindex="-1"></a>not_mez[<span class="st">"start_time"</span>] <span class="op">=</span> pd.to_datetime(not_me[<span class="st">"start_time"</span>], <span class="bu">format</span><span class="op">=</span><span class="st">"mixed"</span>).dt.tz_localize(<span class="va">None</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="c61985c4" class="cell" data-execution_count="28">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb35"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_stacked_timeseries(me_df, not_me_df):</span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a>    me_df <span class="op">=</span> me_df.sort_values(<span class="st">'start_time'</span>)</span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a>    not_me_df <span class="op">=</span> not_me_df.sort_values(<span class="st">'start_time'</span>)</span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>    fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>].plot(me_df[<span class="st">'start_time'</span>], me_df[<span class="st">'interval'</span>], color<span class="op">=</span><span class="st">'#7CBFAF'</span>, label<span class="op">=</span><span class="st">'mine'</span>)</span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>].set_ylabel(<span class="st">'interval (minutes)'</span>)</span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>].set_title(<span class="st">'time to reply (mine)'</span>)</span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">1</span>].plot(not_me_df[<span class="st">'start_time'</span>], not_me_df[<span class="st">'interval'</span>], color<span class="op">=</span><span class="st">'#5B7E37'</span>, label<span class="op">=</span><span class="st">'theirs'</span>)</span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">1</span>].set_ylabel(<span class="st">'interval (minutes)'</span>)</span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">1</span>].set_xlabel(<span class="st">'Date'</span>)</span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">1</span>].set_title(<span class="st">'time to reply (theirs)'</span>)</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ax <span class="kw">in</span> axs:</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>        ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>)</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb35-15"><a href="#cb35-15" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb35-16"><a href="#cb35-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-17"><a href="#cb35-17" aria-hidden="true" tabindex="-1"></a>plot_stacked_timeseries(mez, not_mez)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="matsuri_files/figure-html/cell-29-output-1.png" width="1136" height="752" class="figure-img"></p>
</figure>
</div>
</div>
</div>
</section>
<section id="full-on-bootstrapping" class="level2">
<h2 class="anchored" data-anchor-id="full-on-bootstrapping">…. full on bootstrapping</h2>
<p>Earlier, we used a lightweight version of bootstrapping to scan for a potential shift in the timing of first messages; we’re doing the full thing now, since we’ve got around 6,000 conversational turns.</p>
<p>By resampling from all the other days, we can build a kind of “null distribution” — a picture of what the mean response time would look like if this day were totally typical, then we compare the real value from the actual day to that distribution.</p>
<p>This gives us a way to identify specific days where the rhythm of conversation — like how fast (or slow) one of us replied — significantly changed. It’s useful because it doesn’t assume anything about how response times are distributed; it just asks…. is this day weird compared to all the others?</p>
<div id="60be790a" class="cell" data-execution_count="29">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb36"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> bootstrap_test(df, stat<span class="op">=</span><span class="st">'mean'</span>, n_boot<span class="op">=</span><span class="dv">10000</span>):</span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'start_time'</span>] <span class="op">=</span> pd.to_datetime(df[<span class="st">'start_time'</span>])</span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a>    df[<span class="st">'date'</span>] <span class="op">=</span> df[<span class="st">'start_time'</span>].dt.date</span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>    results <span class="op">=</span> []</span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    start <span class="op">=</span> date(<span class="dv">2025</span>, <span class="dv">3</span>, <span class="dv">28</span>)</span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    end <span class="op">=</span> date(<span class="dv">2025</span>, <span class="dv">5</span>, <span class="dv">28</span>)</span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    all_dates <span class="op">=</span> [start <span class="op">+</span> timedelta(days<span class="op">=</span>i) <span class="cf">for</span> i <span class="kw">in</span> <span class="bu">range</span>((end <span class="op">-</span> start).days <span class="op">+</span> <span class="dv">1</span>)]</span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> d <span class="kw">in</span> all_dates:</span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a>        group <span class="op">=</span> df[df[<span class="st">'date'</span>] <span class="op">==</span> d][<span class="st">'interval'</span>]</span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a>        rest <span class="op">=</span> df[df[<span class="st">'date'</span>] <span class="op">!=</span> d][<span class="st">'interval'</span>]</span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">len</span>(group) <span class="op">&lt;</span> <span class="dv">5</span>:</span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>            <span class="cf">continue</span></span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>        <span class="cf">if</span> stat <span class="op">==</span> <span class="st">'mean'</span>:</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>            boot_stats <span class="op">=</span> np.array([rest.sample(<span class="bu">len</span>(group), replace<span class="op">=</span><span class="va">True</span>).mean() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_boot)])</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a>            observed <span class="op">=</span> group.mean()</span>
<span id="cb36-16"><a href="#cb36-16" aria-hidden="true" tabindex="-1"></a>        <span class="cf">elif</span> stat <span class="op">==</span> <span class="st">'median'</span>:</span>
<span id="cb36-17"><a href="#cb36-17" aria-hidden="true" tabindex="-1"></a>            boot_stats <span class="op">=</span> np.array([rest.sample(<span class="bu">len</span>(group), replace<span class="op">=</span><span class="va">True</span>).median() <span class="cf">for</span> _ <span class="kw">in</span> <span class="bu">range</span>(n_boot)])</span>
<span id="cb36-18"><a href="#cb36-18" aria-hidden="true" tabindex="-1"></a>            observed <span class="op">=</span> group.median()</span>
<span id="cb36-19"><a href="#cb36-19" aria-hidden="true" tabindex="-1"></a>        <span class="cf">else</span>:</span>
<span id="cb36-20"><a href="#cb36-20" aria-hidden="true" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="st">"stat must be 'mean' or 'median'"</span>)</span>
<span id="cb36-21"><a href="#cb36-21" aria-hidden="true" tabindex="-1"></a>        p_val <span class="op">=</span> np.mean(np.<span class="bu">abs</span>(boot_stats <span class="op">-</span> boot_stats.mean()) <span class="op">&gt;=</span> np.<span class="bu">abs</span>(observed <span class="op">-</span> boot_stats.mean()))</span>
<span id="cb36-22"><a href="#cb36-22" aria-hidden="true" tabindex="-1"></a>        ci_lower <span class="op">=</span> np.percentile(boot_stats, <span class="fl">2.5</span>)</span>
<span id="cb36-23"><a href="#cb36-23" aria-hidden="true" tabindex="-1"></a>        ci_upper <span class="op">=</span> np.percentile(boot_stats, <span class="fl">97.5</span>)</span>
<span id="cb36-24"><a href="#cb36-24" aria-hidden="true" tabindex="-1"></a>        direction <span class="op">=</span> <span class="st">'higher'</span> <span class="cf">if</span> observed <span class="op">&gt;</span> boot_stats.mean() <span class="cf">else</span> <span class="st">'lower'</span></span>
<span id="cb36-25"><a href="#cb36-25" aria-hidden="true" tabindex="-1"></a>        results.append({</span>
<span id="cb36-26"><a href="#cb36-26" aria-hidden="true" tabindex="-1"></a>            <span class="st">'date'</span>: d,</span>
<span id="cb36-27"><a href="#cb36-27" aria-hidden="true" tabindex="-1"></a>            <span class="st">'p_value'</span>: p_val,</span>
<span id="cb36-28"><a href="#cb36-28" aria-hidden="true" tabindex="-1"></a>            <span class="st">'n_obs'</span>: <span class="bu">len</span>(group),</span>
<span id="cb36-29"><a href="#cb36-29" aria-hidden="true" tabindex="-1"></a>            <span class="st">'observed'</span>: observed,</span>
<span id="cb36-30"><a href="#cb36-30" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ci_lower'</span>: ci_lower,</span>
<span id="cb36-31"><a href="#cb36-31" aria-hidden="true" tabindex="-1"></a>            <span class="st">'ci_upper'</span>: ci_upper, </span>
<span id="cb36-32"><a href="#cb36-32" aria-hidden="true" tabindex="-1"></a>            <span class="st">'direction'</span>: direction</span>
<span id="cb36-33"><a href="#cb36-33" aria-hidden="true" tabindex="-1"></a>        })</span>
<span id="cb36-34"><a href="#cb36-34" aria-hidden="true" tabindex="-1"></a>    <span class="cf">return</span> pd.DataFrame(results)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="70111f20" class="cell" data-execution_count="30">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb37"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a>me4_mean <span class="op">=</span> bootstrap_test(mez)</span>
<span id="cb37-2"><a href="#cb37-2" aria-hidden="true" tabindex="-1"></a>se4_mean <span class="op">=</span> bootstrap_test(not_mez)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
</div>
<div id="1c919d84" class="cell" data-execution_count="31">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb38"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="kw">def</span> plot_stacked_bootstrap(me_df, not_me_df, title1<span class="op">=</span><span class="st">"time to reply (me)"</span>, title2<span class="op">=</span><span class="st">"time to reply (them)"</span>):</span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>    fig, axs <span class="op">=</span> plt.subplots(<span class="dv">2</span>, <span class="dv">1</span>, figsize<span class="op">=</span>(<span class="dv">12</span>, <span class="dv">8</span>), sharex<span class="op">=</span><span class="va">True</span>)</span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="cf">for</span> ax, results_df, color, title <span class="kw">in</span> <span class="bu">zip</span>(</span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>        axs,</span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>        [me_df, not_me_df],</span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>        [<span class="st">'#7CBFAF'</span>, <span class="st">'#5B7E37'</span>],</span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>        [title1, title2]</span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    ):</span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>        results_df <span class="op">=</span> results_df.sort_values(<span class="st">"date"</span>)</span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>        x <span class="op">=</span> pd.to_datetime(results_df[<span class="st">"date"</span>])</span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>        y <span class="op">=</span> results_df[<span class="st">"observed"</span>]</span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>        lower <span class="op">=</span> results_df[<span class="st">"ci_lower"</span>]</span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>        upper <span class="op">=</span> results_df[<span class="st">"ci_upper"</span>]</span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>        ax.plot(x, y, label<span class="op">=</span><span class="st">"Observed"</span>, color<span class="op">=</span>color, linewidth<span class="op">=</span><span class="dv">2</span>)</span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>        ax.fill_between(x, lower, upper, color<span class="op">=</span>color, alpha<span class="op">=</span><span class="fl">0.2</span>, label<span class="op">=</span><span class="st">"95% CI"</span>)</span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a>        ax.axhline(np.mean(y), color<span class="op">=</span><span class="st">'gray'</span>, linestyle<span class="op">=</span><span class="st">'--'</span>, linewidth<span class="op">=</span><span class="dv">1</span>, label<span class="op">=</span><span class="st">"Overall mean"</span>)</span>
<span id="cb38-17"><a href="#cb38-17" aria-hidden="true" tabindex="-1"></a>        ax.set_title(title)</span>
<span id="cb38-18"><a href="#cb38-18" aria-hidden="true" tabindex="-1"></a>        ax.set_ylabel(<span class="st">"time to reply (minutes)"</span>)</span>
<span id="cb38-19"><a href="#cb38-19" aria-hidden="true" tabindex="-1"></a>        ax.tick_params(axis<span class="op">=</span><span class="st">'x'</span>)</span>
<span id="cb38-20"><a href="#cb38-20" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">1</span>].set_xlabel(<span class="st">"day"</span>)</span>
<span id="cb38-21"><a href="#cb38-21" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">0</span>].legend()</span>
<span id="cb38-22"><a href="#cb38-22" aria-hidden="true" tabindex="-1"></a>    axs[<span class="dv">1</span>].legend()</span>
<span id="cb38-23"><a href="#cb38-23" aria-hidden="true" tabindex="-1"></a>    plt.tight_layout()</span>
<span id="cb38-24"><a href="#cb38-24" aria-hidden="true" tabindex="-1"></a>    plt.show()</span>
<span id="cb38-25"><a href="#cb38-25" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb38-26"><a href="#cb38-26" aria-hidden="true" tabindex="-1"></a>plot_stacked_bootstrap(me4_mean, se4_mean)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-display">
<div>
<figure class="figure">
<p><img src="matsuri_files/figure-html/cell-32-output-1.png" width="1136" height="752" class="figure-img"></p>
</figure>
</div>
</div>
</div>
<div id="e7142b0d" class="cell" data-execution_count="32">
<details class="code-fold">
<summary>Code</summary>
<div class="sourceCode cell-code" id="cb39"><pre class="sourceCode python code-with-copy"><code class="sourceCode python"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>mytop3 <span class="op">=</span> me4_mean.sort_values(<span class="st">"p_value"</span>).head(<span class="dv">3</span>)</span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(mytop3)</span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a>theirtop3 <span class="op">=</span> se4_mean.sort_values(<span class="st">"p_value"</span>).head(<span class="dv">3</span>)</span>
<span id="cb39-5"><a href="#cb39-5" aria-hidden="true" tabindex="-1"></a><span class="bu">print</span>(theirtop3)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</details>
<div class="cell-output cell-output-stdout">
<pre><code>          date  p_value  n_obs    observed  ci_lower    ci_upper direction
40  2025-05-12   0.0006      9  283.691648  0.298843  115.003122    higher
42  2025-05-16   0.0032     13  187.097551  0.432065  102.050742    higher
30  2025-04-28   0.0083      7  185.964179  0.250999  118.646447    higher
          date  p_value  n_obs    observed  ci_lower   ci_upper direction
31  2025-04-29   0.0017      6  191.809425  0.263550  78.549388    higher
45  2025-05-19   0.0023      8  130.398608  0.344827  79.154099    higher
43  2025-05-17   0.0061     14   95.791177  0.504755  59.644680    higher</code></pre>
</div>
</div>
</section>
</section>
<section id="results" class="level1">
<h1>5…. results</h1>
<table class="caption-top table">
<colgroup>
<col style="width: 29%">
<col style="width: 33%">
<col style="width: 37%">
</colgroup>
<thead>
<tr class="header">
<th>Test</th>
<th>Strongest Point of Change (Me)</th>
<th>Strongest Point of Change (Them)</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1: Median Split</td>
<td>May 17 2025</td>
<td>April 24, 2025</td>
</tr>
<tr class="even">
<td>2: First-order Markov</td>
<td>May 20 2025</td>
<td>May 20 2025</td>
</tr>
<tr class="odd">
<td>3: Earth Mover’s Distance</td>
<td>April 24, 2025</td>
<td>April 15, 2025</td>
</tr>
<tr class="even">
<td>4: Bootstrapping</td>
<td>May 12, 2025</td>
<td>April 29, 2025</td>
</tr>
</tbody>
</table>
</section>
<section id="conclusion" class="level1">
<h1>6 …. conclusion</h1>
<section id="the-actual-day-of-the-treatment-was-april-24-2025" class="level4">
<h4 class="anchored" data-anchor-id="the-actual-day-of-the-treatment-was-april-24-2025">The actual day of the ‘treatment’ was… April 24, 2025!</h4>
<p>But yeah … the results are kind of all over the place, and we can see (kinda) the effect of the day we know something happened. But the more salient finding (also one does /not/ need probability to learn) is that human relationships are always changing. Things never go back to the way they were, and won’t stay as they are now.</p>
<p>I think I’m going to stop trying to predict other people’s behavior in the future; I’m literally 22 I don’t know anything about how the world works. There are many people I very much enjoy being with, a feeling that can never be expressed in theory, only experienced.</p>
<p>And I’m never going to stop texting that man. Matter of fact I’ve got to go reply right now.</p>
<hr>
</section>
</section>

</main>
<!-- /main column -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const onCopySuccess = function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  }
  const getTextToCopy = function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button:not([data-in-quarto-modal])', {
    text: getTextToCopy
  });
  clipboard.on('success', onCopySuccess);
  if (window.document.getElementById('quarto-embedded-source-code-modal')) {
    const clipboardModal = new window.ClipboardJS('.code-copy-button[data-in-quarto-modal]', {
      text: getTextToCopy,
      container: window.document.getElementById('quarto-embedded-source-code-modal')
    });
    clipboardModal.on('success', onCopySuccess);
  }
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp('/' + window.location.host + '/');
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool):not(.about-link)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>